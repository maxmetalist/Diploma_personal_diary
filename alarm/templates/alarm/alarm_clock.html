{% extends 'base.html' %}

{% block title %}{{ title }} - –õ–∏—á–Ω—ã–µ –∑–∞–ø–∏—Å—É–ª—å–∫–∏{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <h1>‚è∞ {{ title }}</h1>
            <p class="lead">{{ page_description }}</p>

            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∞–º–∏</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'alarm:alarm_create' %}" class="btn btn-primary w-100">
                                ‚ûï –°–æ–∑–¥–∞—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'alarm:alarm_list' %}" class="btn btn-outline-primary w-100">
                                üìã –ú–æ–∏ –±—É–¥–∏–ª—å–Ω–∏–∫–∏
                            </a>
                        </div>
                    </div>

                    <hr>

                    <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±—É–¥–∏–ª—å–Ω–∏–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</p>
                    <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è:</p>
                    <ul>
                        <li>–¢–∞–π–º–µ—Ä—ã –∏ —Å–µ–∫—É–Ω–¥–æ–º–µ—Ä</li>
                        <li>–ì–æ–ª–æ—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</li>
                        <li>–Ø –ø–æ–∫–∞ –Ω–µ —É—Å–ø–µ–≤–∞—é –∑–∞–ø–∏–ª–∏—Ç—å —Ç–∞–∫–∏–µ –ø–ª—é—à–∫–∏,
                            —Ç–∞–∫ —á—Ç–æ —ç—Ç–æ –Ω–∞ –±—É–¥—É—â–µ–µ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.getElementById('test-alarm-check').addEventListener('click', function() {
    console.log("üîÑ –ó–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤...");

    fetch('{% url "alarm:check_alarms" %}')
        .then(response => {
            console.log("üìû –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Å—Ç–∞—Ç—É—Å:", response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log("üìä –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:", data);
            const statusDiv = document.getElementById('alarm-status');

            if (data.error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞: ${data.error}</div>`;
            } else if (data.ringing_alarms && data.ringing_alarms.length > 0) {
                statusDiv.innerHTML = `<div class="alert alert-success">üéä –°—Ä–∞–±–æ—Ç–∞–ª–æ –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤: ${data.ringing_alarms.length}</div>`;
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –±—É–¥–∏–ª—å–Ω–∏–∫–∞
                window.location.href = '{% url "alarm:alarm_ring" 0 %}'.replace('0', data.ringing_alarms[0].id);
            } else {
                statusDiv.innerHTML = '<div class="alert alert-info">‚è∞ –ê–∫—Ç–∏–≤–Ω—ã—Ö –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤ –Ω–µ—Ç</div>';
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞:', error);
            document.getElementById('alarm-status').innerHTML =
                `<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}</div>`;
        });
});
</script>

{% endblock %}
