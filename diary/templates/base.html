<!DOCTYPE html>
{% load static %}
<html lang="ru" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–õ–∏—á–Ω—ã–µ –∑–∞–ø–∏—Å—É–ª—å–∫–∏{% endblock %}</title>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'style.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="side-panel">
        <div class="panel-tab">‚ò∞</div>

        <div class="panel-content">
            <div class="user-profile-section text-center mb-4">
                <div class="avatar-container position-relative d-inline-block">
                    {% if user.is_authenticated and user.avatar %}
                        <img src="{{ user.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="user-avatar-sidebar">
                    {% else %}
                        <div class="user-avatar-sidebar default-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                    {% if user.is_authenticated %}
                        <div class="online-indicator" title="–í —Å–µ—Ç–∏"></div>
                    {% else %}
                        <div class="offline-indicator" title="–ù–µ –≤ —Å–µ—Ç–∏"></div>
                    {% endif %}
                </div>
                {% if user.is_authenticated %}
                    <h6 class="user-name mt-2 mb-1">{{ user.first_name }} {{ user.last_name }}</h6>
                    <p class="user-email small text-white-50">{{ user.email }}</p>
                    <div class="online-status">
                        <span class="status-dot online"></span>
                        <small class="status-text">–í —Å–µ—Ç–∏</small>
                    </div>
                {% else %}
                    <h6 class="user-name mt-2 mb-1">–ì–æ—Å—Ç—å</h6>
                    <p class="user-email small text-white-50">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</p>
                    <div class="online-status">
                        <span class="status-dot offline"></span>
                        <small class="status-text">–ù–µ –≤ —Å–µ—Ç–∏</small>
                    </div>
                {% endif %}
            </div>

            <h5 class="mb-3 border-bottom pb-2">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h5>

            <button class="panel-btn" data-page="home">
                üè† –î–æ–º–∞—à–Ω—è—è
            </button>

            <button class="panel-btn" data-page="diary">
                üìñ –î–Ω–µ–≤–Ω–∏–∫
            </button>

            <button class="panel-btn" data-page="planning">
                üìÖ –ü–ª–∞–Ω–∏–Ω–≥
            </button>

            <button class="panel-btn" data-page="alarm_clock">
                ‚è∞ –ë—É–¥–∏–ª—å–Ω–∏–∫
            </button>

            <div class="theme-switcher-section mt-4 pt-3">
                <div class="d-flex justify-content-between align-items-center">
                    <span class="theme-label">–¢–µ–º–∞:</span>
                    <div class="theme-switcher">
                        <button class="theme-btn theme-light active" data-theme="light" title="–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞">
                            <i class="fas fa-sun"></i>
                        </button>
                        <button class="theme-btn theme-dark" data-theme="dark" title="–¢—ë–º–Ω–∞—è —Ç–µ–º–∞">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel-footer">
            <button class="panel-btn" id="accountMenuBtn">
                üë§ –ê–∫–∫–∞—É–Ω—Ç
            </button>

            <div class="account-menu" id="accountMenu">
                {% if user.is_authenticated %}
                    <span class="text-white small p-2 d-block">
                        –ü—Ä–∏–≤–µ—Ç, {{ user.first_name }}!
                    </span>
                    <a href="{% url 'users:profile_edit' %}" class="account-btn text-decoration-none d-block">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <form method="post" action="{% url 'users:logout' %}" class="d-block">
                        {% csrf_token %}
                        <button type="submit" class="account-btn w-100 text-start">
                            üö™ –í—ã–π—Ç–∏
                        </button>
                    </form>
                {% else %}
                    <a href="{% url 'users:login' %}" class="account-btn text-decoration-none d-block">
                        üîë –í–æ–π—Ç–∏
                    </a>
                    <a href="{% url 'users:signup' %}" class="account-btn text-decoration-none d-block">
                        üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">üìñ –ú–æ–π –î–Ω–µ–≤–Ω–∏–∫</a>
            <div class="navbar-nav ms-auto">
                {% if user.is_authenticated %}
                    <span class="navbar-text me-3">
                        –ó–¥–æ—Ä–æ–≤–æ, {{user.first_name}}! –ö–∞–∫–∏–µ –ª—é–¥–∏ –∏ –±–µ–∑ –æ—Ö—Ä–∞–Ω—ã!
                    </span>
                    <a class="nav-link" href="{% url 'diary:entry_create' %}">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</a>
                    <form method="post" action="{% url 'users:logout' %}" class="logout-form">
                        {% csrf_token %}
                        <button type="submit" class="nav-link logout-btn">–í—ã–π—Ç–∏</button>
                    </form>
                {% else %}
                    <a class="nav-link" href="{% url 'users:login' %}">–í–æ–π—Ç–∏</a>
                    <a class="nav-link" href="{% url 'users:signup' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}

        {% block content %}
        {% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.toggleAccountMenu = function() {
            const menu = document.getElementById('accountMenu');
            if (menu) {
                menu.classList.toggle('show');
            }
        };

        window.navigateTo = function(page) {
            const isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};

            if (page === 'home') {
                window.location.href = "{% url 'home' %}";
                return;
            }

            if (!isAuthenticated) {
                window.location.href = "{% url 'users:login' %}";
                return;
            }

            const urls = {
                'diary': "{% url 'diary:entry_list' %}",
                'planning': "{% url 'planner:planning' %}",
                'alarm_clock': "{% url 'alarm:alarm_clock' %}"
            };

            if (urls[page]) {
                window.location.href = urls[page];
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ–º—ã
        function setTheme(theme) {
            document.documentElement.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeButtons(theme);
        }

        function updateThemeButtons(theme) {
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-theme') === theme) {
                    btn.classList.add('active');
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–µ–º—ã
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    setTheme(theme);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.panel-btn[data-page]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    navigateTo(page);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
            const accountMenuBtn = document.getElementById('accountMenuBtn');
            if (accountMenuBtn) {
                accountMenuBtn.addEventListener('click', toggleAccountMenu);
            }

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', function(event) {
                const accountMenu = document.getElementById('accountMenu');
                const accountBtn = document.getElementById('accountMenuBtn');

                if (accountMenu && accountMenu.classList.contains('show')) {
                    if (!accountMenu.contains(event.target) && !accountBtn.contains(event.target)) {
                        accountMenu.classList.remove('show');
                    }
                }
            });

            // –ê–Ω–∏–º–∞—Ü–∏—è –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞
            const onlineIndicator = document.querySelector('.online-indicator');
            if (onlineIndicator) {
                setInterval(() => {
                    onlineIndicator.classList.toggle('pulse');
                }, 2000);
            }
        });
    </script>
</body>
</html>